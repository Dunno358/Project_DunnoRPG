{% extends 'master.html' %}
{% load filters %}
{% block content %}
{% include 'top_bar.html' %}
{% include 'dunnorpg/messages.html' %}
<!-- TODO: Add checking if class armor allows for item when putting on or changing item of armor -->

<style>
    hr   {opacity: 1;}
</style>

<div id='pop-window' class='d-none position-fixed container-fluid mt-5'>
    <div class='row bg-dark c-gold rounded border border-warning mt-5 ms-5 me-5'>

        <div class='row text-center ms-1'>
            <div class='col mt-4'>
                <h5 id='window-action-text-top' class='m-1'></h5>
            </div>
        </div>

        <div class='row text-center ms-1'>
            <div class='col mt-4 mb-2'>
                <h5 id='window-action-text-center' class='m-1'>Action</h5>
            </div>
        </div>

        <div class='row text-end'>
            <div class='col'>
                <a href='https://g.co/kgs/iznN81' id='window-footer-text' class='c-gold text-decoration-underline'></a>
            </div>
        </div>

        <div class='row text-center ms-1'>
            <div class='col m-2'>
                <a onclick='this.parentNode.parentNode.parentNode.parentNode.classList.add("d-none")' class='btn btn-lg btn-outline-danger'>Back</a>
            </div>
        </div>

    </div>
</div>

<div id="result-div" class="d-none h5 position-fixed bg-dark c-gold container-fluid m-0 p-0 border border-primary" style="top: 20vh;">
    <div class='row m-0 p-2'>
        <div class="col text-center h2">
            <span id="result-div-row1"></title>
        </div>
    </div>

    <div class='row m-0'>
        <div class="col text-center h5 p-0 m-0">
            <span id="result-div-row2"></title>
        </div>
    </div>

    <hr class="text-primary" />

    <div class='row m-0 p-4'>
        <div class="col text-end">
            <span id="result-div-row3-col1">Obrażenia: </title>
        </div>
        <div class="col text-start">
            <span id="result-div-row3-col2"></title>
        </div>
    </div>

    <div class='row m-0'>
        <div class="col text-center h5 p-0 m-2">
            <button class="w-50 btn btn-success" onclick="window.location.reload()">OK</button>
        </div>
    </div>

</div>

<div id='dice-input' class='d-none h5 position-fixed bg-dark c-gold container-fluid m-0 p-0 border border-primary' style="top: 0vh; overflow: auto;">

    <div class='row m-0 p-2'>
        <div class="col text-center h2">
            <span id="dice-input-title">Wykonaj atak</title>
        </div>
    </div>

    <div class='row m-0'>
        <div class="col text-center h2">
            <button class="btn btn-danger w-100 font-weight-bold" onclick="show_or_hideById('dice-input')">Wróć</button>
        </div>
        <div class="col text-center h5 p-0 m-0">
            <span id="dice-input-subtitle"></title>
        </div>
        <div class="col text-center h2">
            <button class="btn btn-primary w-100" id="attack-confirm-btn">Dalej</button>
        </div>
    </div>

    <hr class="text-primary" />

    <div class='row m-0 p-2'>
        <div class="col">
            Wynik na kości (celność):
        </div>
        <div class="col ">
            <input type="number" min="0" value="10" class="w-75 text-center border border-warning bg-gray c-gold rounded p-1 ms-4" id="dice-cel"/>
        </div>
    </div>

    <div class='row m-0 p-2'>
        <div class="col">
            Wynik na kości (obrażenia):
        </div>
        <div class="col ">
            <input type="number" min="0" value="10" class="w-75 text-center border border-warning bg-gray c-gold rounded p-1 ms-4" id="dice-dmg"/>
        </div>
    </div>

    <div class='row m-0 p-2'>
        <div class="col">
            Cel ataku:
        </div>
        <div class="col ">
            <select class="w-75 text-center border border-warning bg-gray c-gold rounded p-1 ms-4" id="body-target">
                <option value='torso'>Torso</option>
                <option value='head'>Głowa</option>
                <option value='hands'>Ręce</option>
                <option value='boots'>Nogi</option>
            </select>
        </div>
    </div>

    <div class='row m-0 p-2'>
        <div class="col">
            Dodatkowy bonus (CEL):
        </div>
        <div class="col">
            <input type="number" value="0" class="w-75 text-center border border-warning bg-gray c-gold rounded p-1 ms-4" id="dice-bonus-cel"/>
        </div>
    </div>

    <div class='row m-0 p-2'>
        <div class="col">
            Dodatkowy bonus (DMG):
        </div>
        <div class="col">
            <input type="number" value="0" class="w-75 text-center border border-warning bg-gray c-gold rounded p-1 ms-4" id="dice-bonus"/>
        </div>
    </div>

    <div id="ammo-row">
        <div class='row m-0 p-2'>
            <div class="col-4">
                Amunicja:
            </div>
            <div class="col">
                <select class="w-100 text-center border border-warning bg-gray c-gold rounded p-1 ms-1" id="chosen-ammo">
                    {% for item in ammo %}
                        <option value='{{ item.id }}'>{{ item.name }} x{{ item.amount }}</option>
                    {% endfor %}
                    <option value='not-needed'>Nie wymaga</option>
                </select>
            </div>
        </div>

        <div class='row m-0 p-2'>
            <div class="col">
                Ilość amunicji:
            </div>
            <div class="col">
                <input type="number" value="1" class="w-75 text-center border border-warning bg-gray c-gold rounded p-1 ms-4" id="ammo-count"/>
            </div>
        </div>
    </div>

    <div class='row m-0 p-2'>
        <div class="col">
            Mnożnik obrażeń:
        </div>
        <div class="col">
            <input type="number" value="1" step="0.1" class="w-75 text-center border border-warning bg-gray c-gold rounded p-1 ms-4" id="dmg-multiplier"/>
        </div>
    </div>

    <div class='row m-0 p-2 mb-5'>
        <div class="col">
            Zniszczalność:
        </div>
        <div class="col">
            <select class="w-100 text-center border border-warning bg-gray c-gold rounded p-1 ms-1" id="is-destructible">
                <option value='destructible'>Zniszczalne</option>
                <option value='undestructible'>Niezniszczalne</option>
            </select>
        </div>
    </div>
</div>

<div class="container-fluid">        
    <div class="header-bg bg-dark border-top border-bottom border-primary mt-1 row">
        <button id='Stats'  onclick="show_or_hideByName(this)" class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            Stats</button>

        <button id='Equipment' onclick="show_or_hideByName(this)" class='col m-1 btn btn-dark btn-outline-primary border border-primary rounded'>
            Equipment</button>

        <button id='Skills' onclick="show_or_hideByName(this)" class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            Skills</button>
        
        <button id='Effects' onclick="show_or_hideByName(this)" class='col m-1 btn btn-dark borderborder-warning btn-outline-warning rounded'>
            Effects</button>
    </div>
</div>

<div class="row container-fluid m-0 p-0">
    {% for value in chosen_character %}

    <div class='d-none'>
        <p id='effects-accuraccy'>{{ value.name|getEffectsBonus:"accuraccy" }}</p>
        <p id='effects-attack'>{{ value.name|getEffectsBonus:"attack" }}</p>
        <p id='effects-parry'>{{ value.name|getEffectsBonus:"parry" }}</p>
        <p id='effects-dodge'>{{ value.name|getEffectsBonus:"dodge" }}</p>
        <p id='weapon-weight-mod'>0</p>
        <p id='shield-weight-mod'>0</p>
        <p id='amulet-attack-mod'>{{ value.name|getAmuletAttackBonus }}</p>
    </div>

    <div name='Stats' class="row card-body d-none text-center mt-4 c-gold border border-warning bg-dark rounded position-fixed m-0 p-0">
        <h3>Stats</h3>
        <p name='stat'><span class="text-white-50">INT:</span> <span id='stat-INT'>{{ value.INT }}</span> (<span id='stat-INT-mod'>{{ value|getMod:"INT" }}</span>)</p>
        <p name='stat'><span class="text-white-50">SIŁ:</span> <span id='stat-SIŁ'>{{ value.SIŁ }}</span> (<span id='stat-SIŁ-mod'>{{ value|getMod:"SIŁ" }}</span>)</p>
        <p name='stat'><span class="text-white-50">ZRE:</span> <span id='stat-ZRE'>{{ value.ZRE }}</span> (<span id='stat-ZRE-mod'>{{ value|getMod:"ZRE" }}</span>)</p>
        <p name='stat'><span class="text-white-50">CHAR:</span> <span id='stat-CHAR'>{{ value.CHAR }}</span> (<span id='stat-CHAR-mod'>{{ value|getMod:"CHAR" }}</span>)</p>
        <p name='stat'><span class="text-white-50">CEL:</span> <span id='stat-CEL'>{{ value.CEL }}</span> (<span id='stat-CEL-mod'>{{ value|getMod:"CEL" }}</span>)</p>
    </div>

    <div name='Equipment' class="row text-center m-0 p-0 card-body c-gold border border-warning bg-dark rounded">
        <div class="row mt-2 m-0 p-0">
            <div class="col">
                {% if value.model_url %}
                    <a id='char-name' name='{{ value.id }}' href="{{ value.model_url }}" class="c-gold h2" target="_blank">
                        {{ value.name }}
                    </a>
                {% else %}
                    <span id='char-name' name='{{ value.id }}' class="h1">{{ value.name }}</span>
                {% endif %}
            </div>
        </div>

        <div class="row m-0 p-0">
            <div class="col p-0 m-0 h5">
            {% if value.chosen_class %}
                jako <a 
                href='/dunnorpg/info/classes/{{ class.id }}'
                class='c-gold fst-italic' id='char-class'
                >
                    {% if value.chosen_class != 'None' %}
                        {{ value.chosen_class }}
                    {% endif %}
                </a>
            {% endif %}
            </div>
        </div>

        <div class="row mt-2 m-0 p-0">
            <div class="col rounded p-1 bg-gray bg-gradient border border-warning m-2 p-1 h6 pb-0">
                <span class="text-white-50">Pancerz:</span> 
                <span id='armor'>{{ value.name|getArmor }}</span>
            </div>
            <div class="col rounded p-1 bg-gray bg-gradient border border-warning m-2 p-1 h6 pb-0"> 
                <form class='' method="post" action="change-health">
                    {% csrf_token %}
                    <span class="text-white-50">Życie:</span>
                    <input type='number' id='hp-val' class='c-gold text-center bg-gray bg-gradient border-0 h6' style='width: 6vw' value='{{ value.HP }}' name="hp">/{{ value.fullHP }}
                </form>
            </div>
        </div>

        <div class="row m-0 p-0">
            <div class="col rounded bg-gray bg-gradient border border-warning m-2 p-2 h6">
                <span class="text-white-50">Waga:</span> 
                <span id='armor-weight'>{{ value.name|getArmorWeight }}kg</span>
            </div>
            <div class="col rounded bg-gray bg-gradient border border-warning m-2 p-2 h6">
                <span class="text-white-50">Kara:</span> 
                -<span id='armor-mod'></span> ZRE
            </div>
        </div>

        <div class="row m-0 p-0">
            <div class="col rounded bg-gray bg-gradient border border-warning m-2 p-2 h6">
                <span class="text-white-50">Monety:</span> 
                <span>{{ value.coins  }}</span>
            </div>
        </div>

        <div class="row m-0 p-0 mt-1">
            <div class="col">
                <a class="btn bg-danger bg-gradient text-white w-100 ps-2 pe-2" onclick="show_or_hideById('get-damage')"> <!-- Tutaj pokazanie formularza z wyborem części ciała i wartości dmg, ap oraz OK jako href do viewsa który ogarnie i potem powróci tutaj -->
                    Otrzymano obrażenia
                </a>
            </div>
        </div>

        <div id='get-damage' class='d-none h5 position-fixed bg-dark c-gold container-fluid m-0 p-0 border border-danger' style="top: 5vh; width: 100vw; overflow: auto;">
            <div class="row m-0 p-0 mt-2">
                <div class="col text-center text-danger">
                    <h4>Miejsce obrażeń</h4>
                </div>
            </div>

            <div class="row m-0 p-0">
                <div id="get-dmg-head" class="col bg-gray p-2 m-1 rounded bg-gradient border border-warning get-dmg-place" onclick="setActive('get-dmg-head')">
                    Głowa
                </div>
                <div id="get-dmg-torso" class="col bg-gray p-2 m-1 rounded bg-gradient border border-primary active text-primary get-dmg-place" onclick="setActive('get-dmg-torso')">
                    Torso
                </div>
                <div id="get-dmg-hands" class="col bg-gray p-2 m-1 rounded bg-gradient border border-warning get-dmg-place" onclick="setActive('get-dmg-hands')">
                    Ręce
                </div>
                <div id="get-dmg-legs" class="col bg-gray p-2 m-1 rounded bg-gradient border border-warning get-dmg-place" onclick="setActive('get-dmg-legs')">
                    Nogi
                </div>
                <div id="get-dmg-armor" class="col bg-gray p-2 m-1 rounded bg-gradient border border-warning get-dmg-place" onclick="setActive('get-dmg-armor')">
                    Ignoruj pancerz
                </div>
            </div>

            <div class="row m-0 p-0 mt-2">
                <div class="col text-center text-danger">
                    <h4>Ilość obrażeń</h4>
                </div>
            </div>

            <div class="row m-0 p-0 mt-2">
                <div class="col">
                    <div class="col">
                        Obrażenia:
                    </div>
                    <div class="col">
                        <input type="number" class="bg-gray border border-warning c-gold rounded text-center" id="get-dmg-dmg"/>
                    </div>
                </div>

                <div class="col mt-1 m-0 p-0">
                    <div class="col">
                        AP:
                    </div>
                    <div class="col">
                        <input type="number" class="bg-gray border border-warning c-gold rounded text-center" id="get-dmg-ap"/>
                    </div>
                </div>
            </div>

            <div class="row m-0 p-0 mt-3">
                <div class="col-9 m-0 p-0 text-end">
                    Zastosuj mnożnik ciała:
                </div>
                <div class="col text-start">
                    <input type="checkbox" id="get-dmg-ign-chk" style="width: 5vw; height: 3.5vh" checked />
                </div>
            </div>

            <div class="row m-0 p-0 mt-4 mb-2">
                <div class="col m-0 p-0">
                    <a class="w-75 btn btn-danger" onclick="show_or_hideById('get-damage')">Wróć</a>
                </div>
                <div class="col m-0 p-0">
                    <a class="w-75 btn btn-success" onclick="calculateGettingHit()">OK</a>
                </div>
            </div>
        </div>
        
        <div class="row mt-2 mb-3 m-0 p-0 text-danger">
            <div class="col-5 p-0 m-0"><hr class="bg-danger mt-4"></div>
            <div class="col-2 p-0 m-0">
                <h3 class="mt-2 textdanger">Głowa</h3>
            </div>
            <div class="col-5 p-0 m-0"><hr class="bg-danger mt-4"></div>
        </div>

        {% if helmet %}
            <form name='head' method='post' action='changedur-{{ helmet.id }}' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                {% csrf_token %}
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 ps-3 pb-0">
                        <span class="text-white-50">Wytrzymałość:</span> {{ helmet.durability }}/{{ helmet.name|getMaxDurability }}
                    </div>
                    <div class="col h6 text-end p-2 pb-0">
                        Głowa - {{ helmet.name|getArmorWeightType }}
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='/dunnorpg/items/{{ helmet.name|getDescId }}' class="{{ helmet.name|getItemRarity }} h4">
                            {{ helmet.name }} {{ helmet.name|getDurabilityPercent:helmet.durability }} 
                            {% if user.is_superuser %}
                                <a href="/admin/DunnoRPG/charitems/{{ helmet.id }}/change/" class="fa fa-link" target="_blank"></a>
                            {% endif %}
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
                {% if helmet.name|getSkill %}
                    <div class="row me-0 pe-0">
                        <div class="col text-justified {{ helmet.name|getItemRarity }} p-0 ps-1 pt-1">
                            {{ helmet.name|getSkill }}
                        </div>
                    </div>
                    <hr class="mb-0 mt-1">
                {% endif %}

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Pancerz:</span> <span class="c-gold ms-1">{{ helmet.name|getItemArmor }}</span>
                    </div>                
                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Waga:</span> <span class="c-gold ms-1">{{ helmet.name|getItemWeight }}kg</span>
                    </div>                
                    <div class="col-3 border-end border-warning h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-info p-3 pt-2 pb-2 text-white" onclick='show_or_hideById("helmet-swap")'>Zmień</a>
                    </div>                  
                    <div class="col-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-danger p-3 pt-2 pb-2 text-white" href='move_eq-{{ helmet.id }}'>Odłóż</a>
                    </div>

                </div>

                <div id='helmet-swap' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_helmets %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="swapItem('{{ helmet.id }}', 'helmet-swap')" class='btn w-75 btn-success'>Zamień</a>
                    </div>
                </div>

            </form>
        {% else %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Głowa - Brak
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Brak hełmu
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col border-end border-warning mb-0 d-flex align-items-center justify-content-center">
                        <a class="text-light h5 btn btn-info m-2 w-75" onclick='show_or_hideById("helmet-add")'>Załóż</a>
                    </div>                
                </div>

                <div id='helmet-add' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_helmets %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="wearItem('Helmet', 'helmet-add')" class='btn w-75 btn-success'>OK</a>
                    </div>
                </div> 

            </div>
                
        {% endif %}

        <div class="row mt-3 mb-3 m-0 p-0 text-danger">
            <div class="col-5 p-0 m-0"><hr class="bg-danger mt-4"></div>
            <div class="col-2 p-0 m-0">
                <h3 class="mt-2 textdanger">Tors</h3>
            </div>
            <div class="col-5 p-0 m-0"><hr class="bg-danger mt-4"></div>
        </div>

        {% if torso %}
            <form name='head' method='post' action='changedur-{{ torso.id }}' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                {% csrf_token %}
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 ps-3 pb-0">
                        <span class="text-white-50">Wytrzymałość:</span> {{ torso.durability }}/{{ torso.name|getMaxDurability }}
                    </div>
                    <div class="col h6 text-end p-2 pb-0">
                        Tors - {{ torso.name|getArmorWeightType }}
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='/dunnorpg/items/{{ torso.name|getDescId }}' class="{{ torso.name|getItemRarity }} h4">
                            {{ torso.name }} {{ torso.name|getDurabilityPercent:torso.durability }} 
                            {% if user.is_superuser %}
                                <a href="/admin/DunnoRPG/charitems/{{ torso.id }}/change/" class="fa fa-link" target="_blank"></a>
                            {% endif %}
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
                {% if torso.name|getSkill %}
                    <div class="row me-0 pe-0">
                        <div class="col text-justified {{ torso.name|getItemRarity }} p-0 ps-1 pt-1">
                            {{ torso.name|getSkill }}
                        </div>
                    </div>
                    <hr class="mb-0 mt-1">
                {% endif %}

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Pancerz:</span> <span class="c-gold ms-1">{{ torso.name|getItemArmor }}</span>
                    </div>                
                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Waga:</span> <span class="c-gold ms-1">{{ torso.name|getItemWeight }}kg</span>
                    </div>                
                    <div class="col-3 border-end border-warning h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-info p-3 pt-2 pb-2 text-white" onclick='show_or_hideById("torso-swap")'>Zmień</a>
                    </div>                  
                    <div class="col-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-danger p-3 pt-2 pb-2 text-white" href='move_eq-{{ torso.id }}'>Odłóż</a>
                    </div>

                </div>

                <div id='torso-swap' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_torsos %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="swapItem('{{ torso.id }}', 'torso-swap')" class='btn w-75 btn-success'>Zamień</a>
                    </div>
                </div>

            </form>
        {% else %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Tors - Brak
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Brak napierśnika
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col border-end border-warning mb-0 d-flex align-items-center justify-content-center">
                        <a class="text-light h5 btn btn-info m-2 w-75" onclick='show_or_hideById("torso-add")'>Załóż</a>
                    </div>                
                </div>

                <div id='torso-add' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_torsos %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="wearItem('Torso', 'torso-add')" class='btn w-75 btn-success'>OK</a>
                    </div>
                </div> 

            </div>
                
        {% endif %}

        <div class="row mt-3 mb-3 m-0 p-0 text-danger">
            <div class="col-4 p-0 m-0"><hr class="bg-danger mt-4"></div>
            <div class="col-4 p-0 m-0">
                <h3 class="mt-2 textdanger">Lewa ręka</h3>
            </div>
            <div class="col-4 p-0 m-0"><hr class="bg-danger mt-4"></div>
        </div>


        <span id="l-name">{{ leftItem.name }}</span>
        {% if value.name|handNotAllowed:'left' %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Lewa ręka - Zajęta
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Ręka niedostępna
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
            </div>
        {% elif leftItem %}

            <form name='head' method='post' action='changedur-{{ leftItem.id }}' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                {% csrf_token %}

                <!-- call it some meta for weapon -->
                <span class="d-none" id="l-range">{{ leftItem.name|getItemRange }}</span>
                <span class="d-none" id="l-staff-dmg">{{ leftItem.name|getStaffMagicDmg:value.id }}</span>
                <span class="d-none" id="l-dualhanded">{{ leftItem.name|isDualHanded }}</span>

                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 ps-3 pb-0">
                        <span class="text-white-50">Wytrzymałość:</span> {{ leftItem.durability }}/{{ leftItem.name|getMaxDurability }}
                    </div>
                    <div class="col h6 text-end p-2 pb-0">
                        Lewa ręka - <span id="l-type">{{ leftItem.name|getItemType:'pl' }}</span>
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='/dunnorpg/items/{{ leftItem.name|getDescId }}' class="{{ leftItem.name|getItemRarity }} h4">
                            {{ leftItem.name }} <span id="l-dur-perc">{{ leftItem.name|getDurabilityPercent:leftItem.durability }}</span> 
                            {% if user.is_superuser %}
                                <a href="/admin/DunnoRPG/charitems/{{ leftItem.id }}/change/" class="fa fa-link" target="_blank"></a>
                            {% endif %}
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
                {% if leftItem.name|getSkill %}
                    <div class="row me-0 pe-0">
                        <div class="col text-justified {{ leftItem.name|getItemRarity }} p-0 ps-1 pt-1">
                            {{ leftItem.name|getSkill }}
                        </div>
                    </div>
                    <hr class="mb-0 mt-1">
                {% endif %}

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col-3 border-end border-warning p-1 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="c-gold ms-1">
                            <span id="l_stats">{{ leftItem.name|getItemStatByName }}</span> <span id='l_bonus'>{{ value.name|isPreffereOrUnliked:leftItem.name }}</span>
                        </span>
                    </div>                
                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Waga:</span> <span class="c-gold ms-1" id="l-weight">{{ leftItem.name|getItemWeight }}kg</span>
                    </div>                
                    <div class="col-3 border-end border-warning h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-info p-3 pt-2 pb-2 text-white" onclick='show_or_hideById("leftItem-swap")'>Zmień</a>
                    </div>                  
                    <div class="col-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-danger p-3 pt-2 pb-2 text-white" href='move_eq-{{ leftItem.id }}'>Odłóż</a>
                    </div>

                </div>

                <a class="row ps-0 ms-0 me-0 pe-0 border-0 border-top border-warning btn btn-success rounded-0"
                onclick='gatherAttackInfo("left", {{ leftItem.id }})'
                >
                    <span class="h4">Wykonaj atak</span>
                </a>

                <div id='leftItem-swap' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_weapons %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="swapItem('{{ leftItem.id }}', 'leftItem-swap')" class='btn w-75 btn-success'>Zamień</a>
                    </div>
                </div>

            </form>
        {% else %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Lewa ręka - Pusto
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Brak broni
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col border-end border-warning mb-0 d-flex align-items-center justify-content-center">
                        <a class="text-light h5 btn btn-info m-2 w-75" onclick='show_or_hideById("leftItem-add")'>Załóż</a>
                    </div>                
                </div>

                <div id='leftItem-add' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_weapons %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="wearItem('Left', 'leftItem-add')" class='btn w-75 btn-success'>OK</a>
                    </div>
                </div> 

            </div>
                
        {% endif %}

        <div class="row mt-3 mb-3 m-0 p-0 text-danger">
            <div class="col-4 p-0 m-0"><hr class="bg-danger mt-4"></div>
            <div class="col-4 p-0 m-0">
                <h3 class="mt-2 textdanger">Prawa ręka</h3>
            </div>
            <div class="col-4 p-0 m-0"><hr class="bg-danger mt-4"></div>
        </div>

        <span id="r-name">{{ rightItem.name }}</span>
        {% if value.name|handNotAllowed:'right' %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Prawa ręka - Zajęta
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Ręka niedostępna
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
            </div>
        {% elif rightItem %}

            <form name='head' method='post' action='changedur-{{ rightItem.id }}' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                {% csrf_token %}

                <!-- call it some meta for weapon -->
                <span class="d-none" id="r-range">{{ rightItem.name|getItemRange }}</span>
                <span class="d-none" id="r-staff-dmg">{{ rightItem.name|getStaffMagicDmg:value.id }}</span>
                <span class="d-none" id="r-dualhanded">{{ rightItem.name|isDualHanded }}</span>

                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 ps-3 pb-0">
                        <span class="text-white-50">Wytrzymałość:</span> {{ rightItem.durability }}/{{ rightItem.name|getMaxDurability }}
                    </div>
                    <div class="col h6 text-end p-2 pb-0">
                        Prawa ręka - <span id="r-type">{{ rightItem.name|getItemType:'pl' }}</span>
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='/dunnorpg/items/{{ rightItem.name|getDescId }}' class="{{ rightItem.name|getItemRarity }} h4">
                            {{ rightItem.name }} <span id="r-dur-perc">{{ rightItem.name|getDurabilityPercent:rightItem.durability }}</span> 
                            {% if user.is_superuser %}
                                <a href="/admin/DunnoRPG/charitems/{{ rightItem.id }}/change/" class="fa fa-link" target="_blank"></a>
                            {% endif %}
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
                {% if rightItem.name|getSkill %}
                    <div class="row me-0 pe-0">
                        <div class="col text-justified {{ rightItem.name|getItemRarity }} p-0 ps-1 pt-1">
                            {{ rightItem.name|getSkill }}
                        </div>
                    </div>
                    <hr class="mb-0 mt-1">
                {% endif %}

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col-3 border-end border-warning p-1 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="c-gold ms-1">
                            <span id="r_stats">{{ rightItem.name|getItemStatByName }}</span> <span id='r_bonus'>{{ value.name|isPreffereOrUnliked:rightItem.name }}</span>
                        </span>
                    </div>                
                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Waga:</span> <span class="c-gold ms-1" id="r-weight">{{ rightItem.name|getItemWeight }}kg</span>
                    </div>                
                    <div class="col-3 border-end border-warning h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-info p-3 pt-2 pb-2 text-white" onclick='show_or_hideById("rightItem-swap")'>Zmień</a>
                    </div>                  
                    <div class="col-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-danger p-3 pt-2 pb-2 text-white" href='move_eq-{{ rightItem.id }}'>Odłóż</a>
                    </div>

                </div>

                <a class="row ps-0 ms-0 me-0 pe-0 border-0 border-top border-warning btn btn-success rounded-0"
                onclick='gatherAttackInfo("right", {{ rightItem.id }})'
                >
                    <span class="h4">Wykonaj atak</span>
                </a>

                <div id='rightItem-swap' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_weapons %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="swapItem('{{ rightItem.id }}', 'rightItem-swap')" class='btn w-75 btn-success'>Zamień</a>
                    </div>
                </div>

            </form>
        {% else %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Prawa ręka - Pusto
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Brak broni
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col border-end border-warning mb-0 d-flex align-items-center justify-content-center">
                        <a class="text-light h5 btn btn-info m-2 w-75" onclick='show_or_hideById("rightItem-add")'>Załóż</a>
                    </div>                
                </div>

                <div id='rightItem-add' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_weapons %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="wearItem('Left', 'rightItem-add')" class='btn w-75 btn-success'>OK</a>
                    </div>
                </div> 

            </div>
                
        {% endif %}

        <div class="row mt-3 mb-3 m-0 p-0 text-danger">
            <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
            <div class="col-6 p-0 m-0">
                <h3 class="mt-2 textdanger">Miejsce przy pasie</h3>
            </div>
            <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
        </div>

        {% if sideItem %}
            <form name='head' method='post' action='changedur-{{ sideItem.id }}' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                {% csrf_token %}
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 ps-3 pb-0">
                        <span class="text-white-50">Wytrzymałość:</span> {{ sideItem.durability }}/{{ sideItem.name|getMaxDurability }}
                    </div>
                    <div class="col h6 text-end p-2 pb-0">
                        Miejsce przy pasie
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='/dunnorpg/items/{{ sideItem.name|getDescId }}' class="{{ sideItem.name|getItemRarity }} h4">
                            {{ sideItem.name }} {{ sideItem.name|getDurabilityPercent:sideItem.durability }} 
                            {% if user.is_superuser %}
                                <a href="/admin/DunnoRPG/charitems/{{ sideItem.id }}/change/" class="fa fa-link" target="_blank"></a>
                            {% endif %}
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
                {% if sideItem.name|getSkill %}
                    <div class="row me-0 pe-0">
                        <div class="col text-justified {{ sideItem.name|getItemRarity }} p-0 ps-1 pt-1">
                            {{ sideItem.name|getSkill }}
                        </div>
                    </div>
                    <hr class="mb-0 mt-1">
                {% endif %}

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col-3 border-end border-warning p-1 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="c-gold ms-1">{{ sideItem.name|getItemStatByName }}</span>
                    </div>                
                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Waga:</span> <span class="c-gold ms-1">{{ sideItem.name|getItemWeight }}kg</span>
                    </div>                
                    <div class="col-3 border-end border-warning h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-info p-3 pt-2 pb-2 text-white" onclick='show_or_hideById("sideItem-swap")'>Zmień</a>
                    </div>                  
                    <div class="col-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-danger p-3 pt-2 pb-2 text-white" href='move_eq-{{ sideItem.id }}'>Odłóż</a>
                    </div>

                </div>

                <div class="row ps-0 ms-1 me-0 pe-0 border-top border-warning">
                    <a class="col btn btn-primary pt-1 p-0 m-1 ms-0 text-light" href="swap_side/left"><b>Do lewej ręki</b></a>
                    <a class="col btn btn-primary pt-1 p-0 m-1 ms-0 text-light" href="swap_side/right"><b>Do prawej ręki</b></a>               
                </div>

                <div id='sideItem-swap' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_weapons %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="swapItem('{{ sideItem.id }}', 'sideItem-swap')" class='btn w-75 btn-success'>Zamień</a>
                    </div>
                </div>

            </form>
        {% else %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Miejsce przy pasie - Pusto
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Brak przedmiotu
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col border-end border-warning mb-0 d-flex align-items-center justify-content-center">
                        <a class="text-light h5 btn btn-info m-2 w-75" onclick='show_or_hideById("sideItem-add")'>Załóż</a>
                    </div>                
                </div>

                <div id='sideItem-add' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_weapons %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="wearItem('Side', 'sideItem-add')" class='btn w-75 btn-success'>OK</a>
                    </div>
                </div> 

            </div>
                
        {% endif %}

        <div class="row mt-3 mb-3 m-0 p-0 text-danger">
            <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
            <div class="col-2 p-0 m-0">
                <h3 class="mt-2 textdanger">Nogi</h3>
            </div>
            <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
        </div>

        {% if boots %}
            <form name='head' method='post' action='changedur-{{ boots.id }}' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                {% csrf_token %}
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 ps-3 pb-0">
                        <span class="text-white-50">Wytrzymałość:</span> {{ boots.durability }}/{{ boots.name|getMaxDurability }}
                    </div>
                    <div class="col h6 text-end p-2 pb-0">
                        Nogi - {{ boots.name|getArmorWeightType }}
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='/dunnorpg/items/{{ boots.name|getDescId }}' class="{{ boots.name|getItemRarity }} h4">
                            {{ boots.name }} {{ boots.name|getDurabilityPercent:boots.durability }} 
                            {% if user.is_superuser %}
                                <a href="/admin/DunnoRPG/charitems/{{ boots.id }}/change/" class="fa fa-link" target="_blank"></a>
                            {% endif %}
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
                {% if boots.name|getSkill %}
                    <div class="row me-0 pe-0">
                        <div class="col text-justified {{ boots.name|getItemRarity }} p-0 ps-1 pt-1">
                            {{ boots.name|getSkill }}
                        </div>
                    </div>
                    <hr class="mb-0 mt-1">
                {% endif %}

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Pancerz:</span> <span class="c-gold ms-1">{{ boots.name|getItemArmor }}</span>
                    </div>                
                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Waga:</span> <span class="c-gold ms-1">{{ boots.name|getItemWeight }}kg</span>
                    </div>                
                    <div class="col-3 border-end border-warning h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-info p-3 pt-2 pb-2 text-white" onclick='show_or_hideById("boots-swap")'>Zmień</a>
                    </div>                  
                    <div class="col-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-danger p-3 pt-2 pb-2 text-white" href='move_eq-{{ boots.id }}'>Odłóż</a>
                    </div>

                </div>

                <div id='boots-swap' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_boots %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="swapItem('{{ boots.id }}', 'boots-swap')" class='btn w-75 btn-success'>Zamień</a>
                    </div>
                </div>

            </form>
        {% else %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Nogi - Brak
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Brak butów
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col border-end border-warning mb-0 d-flex align-items-center justify-content-center">
                        <a class="text-light h5 btn btn-info m-2 w-75" onclick='show_or_hideById("boots-add")'>Załóż</a>
                    </div>                
                </div>

                <div id='boots-add' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_boots %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="wearItem('Boots', 'boots-add')" class='btn w-75 btn-success'>OK</a>
                    </div>
                </div> 

            </div>
                
        {% endif %}

        <div class="row mt-3 mb-3 m-0 p-0 text-danger">
            <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
            <div class="col-2 p-0 m-0">
                <h3 class="mt-2 textdanger">Ręce</h3>
            </div>
            <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
        </div>

        {% if gloves %}
            <form name='head' method='post' action='changedur-{{ gloves.id }}' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                {% csrf_token %}
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 ps-3 pb-0">
                        <span class="text-white-50">Wytrzymałość:</span> {{ gloves.durability }}/{{ gloves.name|getMaxDurability }}
                    </div>
                    <div class="col h6 text-end p-2 pb-0">
                        Ręce - {{ gloves.name|getArmorWeightType }}
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='/dunnorpg/items/{{ gloves.name|getDescId }}' class="{{ gloves.name|getItemRarity }} h4">
                            {{ gloves.name }} {{ gloves.name|getDurabilityPercent:gloves.durability }} 
                            {% if user.is_superuser %}
                                <a href="/admin/DunnoRPG/charitems/{{ gloves.id }}/change/" class="fa fa-link" target="_blank"></a>
                            {% endif %}
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
                {% if gloves.name|getSkill %}
                    <div class="row me-0 pe-0">
                        <div class="col text-justified {{ gloves.name|getItemRarity }} p-0 ps-1 pt-1">
                            {{ gloves.name|getSkill }}
                        </div>
                    </div>
                    <hr class="mb-0 mt-1">
                {% endif %}

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Pancerz:</span> <span class="c-gold ms-1">{{ gloves.name|getItemArmor }}</span>
                    </div>                
                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Waga:</span> <span class="c-gold ms-1">{{ gloves.name|getItemWeight }}kg</span>
                    </div>                
                    <div class="col-3 border-end border-warning h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-info p-3 pt-2 pb-2 text-white" onclick='show_or_hideById("gloves-swap")'>Zmień</a>
                    </div>                  
                    <div class="col-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-danger p-3 pt-2 pb-2 text-white" href='move_eq-{{ gloves.id }}'>Odłóż</a>
                    </div>

                </div>

                <div id='gloves-swap' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_gloves %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="swapItem('{{ gloves.id }}', 'gloves-swap')" class='btn w-75 btn-success'>Zamień</a>
                    </div>
                </div>

            </form>
        {% else %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Ręce - Brak
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Brak rękawic
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col border-end border-warning mb-0 d-flex align-items-center justify-content-center">
                        <a class="text-light h5 btn btn-info m-2 w-75" onclick='show_or_hideById("gloves-add")'>Załóż</a>
                    </div>                
                </div>

                <div id='gloves-add' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_gloves %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="wearItem('Gloves', 'gloves-add')" class='btn w-75 btn-success'>OK</a>
                    </div>
                </div> 

            </div>
                
        {% endif %}

        <div class="row mt-3 mb-3 m-0 p-0 text-danger">
            <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
            <div class="col-3 p-0 m-0">
                <h3 class="mt-2 textdanger">Akcesoria</h3>
            </div>
            <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
        </div>

        {% if amulet %}
            <form name='head' method='post' action='changedur-{{ amulet.id }}' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                {% csrf_token %}
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 ps-3 pb-0">
                        <span class="text-white-50">Wytrzymałość:</span> {{ amulet.durability }}/{{ amulet.name|getMaxDurability }}
                    </div>
                    <div class="col h6 text-end p-2 pb-0">
                        Akcesoria - {{ amulet.name|getArmorWeightType }}
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='/dunnorpg/items/{{ amulet.name|getDescId }}' class="{{ amulet.name|getItemRarity }} h4">
                            {{ amulet.name }}
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
                {% if amulet.name|getSkill %}
                    <div class="row me-0 pe-0">
                        <div class="col text-justified {{ amulet.name|getItemRarity }} p-0 ps-1 pt-1">
                            {{ amulet.name|getSkill }}
                        </div>
                    </div>
                    <hr class="mb-0 mt-1">
                {% endif %}

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Pancerz:</span> <span class="c-gold ms-1">{{ amulet.name|getItemArmor }}</span>
                    </div>                
                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Waga:</span> <span class="c-gold ms-1">{{ amulet.name|getItemWeight }}kg</span>
                    </div>                
                    <div class="col-3 border-end border-warning h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-info p-3 pt-2 pb-2 text-white" onclick='show_or_hideById("amulet-swap")'>Zmień</a>
                    </div>                  
                    <div class="col-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-danger p-3 pt-2 pb-2 text-white" href='move_eq-{{ amulet.id }}'>Odłóż</a>
                    </div>

                </div>

                <div id='amulet-swap' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_amulets %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="swapItem('{{ amulet.id }}', 'amulet-swap')" class='btn w-75 btn-success'>Zamień</a>
                    </div>
                </div>

            </form>
        {% else %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Akcesoria - Brak
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Brak amuletu
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col border-end border-warning mb-0 d-flex align-items-center justify-content-center">
                        <a class="text-light h5 btn btn-info m-2 w-75" onclick='show_or_hideById("amulet-add")'>Załóż</a>
                    </div>                
                </div>

                <div id='amulet-add' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_amulets %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="wearItem('Amulet', 'amulet-add')" class='btn w-75 btn-success'>OK</a>
                    </div>
                </div> 

            </div>
                
        {% endif %}

        {% if mount %}
            <div class="row mt-3 mb-3 m-0 p-0 text-danger">
                <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
                <div class="col-5 p-0 m-0">
                    <h3 class="mt-2 textdanger">Wierzchowiec</h3>
                </div>
                <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
            </div>

            <form name='head' method='post' action='changedur-{{ mount.id }}' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                {% csrf_token %}
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 ps-3 pb-0">
                        <span class="text-white-50">Punkty życia:</span> {{ mount.durability }}/{{ mount.name|getMaxDurability }}
                    </div>
                    <div class="col h6 text-end p-2 pb-0">
                        Wierzchowiec
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='/dunnorpg/items/{{ mount.name|getDescId }}' class="{{ mount.name|getItemRarity }} h4">
                            {{ mount.name }}
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
                {% if mount.name|getSkill %}
                    <div class="row me-0 pe-0">
                        <div class="col text-justified {{ mount.name|getItemRarity }} p-0 ps-1 pt-1">
                            {{ mount.name|getSkill }}
                        </div>
                    </div>
                    <hr class="mb-0 mt-1">
                {% endif %}

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Juki:</span> <span class="c-gold ms-1">{{ mount.name|getItemBonus }}kg</span>
                    </div>                
                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Pancerz:</span> <span id='mount_armor_default' class="c-gold ms-1">{{ mount.name|getItemArmor }}</span>
                    </div>                
                    <div class="col-3 border-end border-warning h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-info p-3 pt-2 pb-2 text-white" onclick='show_or_hideById("mount-swap")'>Zmień</a>
                    </div>                  
                    <div class="col-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-danger p-3 pt-2 pb-2 text-white" href='move_eq-{{ mount.id }}'>Odłóż</a>
                    </div>

                </div>

                <div id='mount-swap' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_mounts %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="swapItem('{{ mount.id }}', 'mount-swap')" class='btn w-75 btn-success'>Zamień</a>
                    </div>
                </div>

            </form>
        {% elif eq_mounts %}
            <div class="row mt-3 mb-3 m-0 p-0 text-danger">
                <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
                <div class="col-5 p-0 m-0">
                    <h3 class="mt-2 textdanger">Wierzchowiec</h3>
                </div>
                <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
            </div>

            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Wierzchowiec - Brak
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Brak wierzchowca
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col border-end border-warning mb-0 d-flex align-items-center justify-content-center">
                        <a class="text-light h5 btn btn-info m-2 w-75" onclick='show_or_hideById("mount-add")'>Załóż</a>
                    </div>                
                </div>

                <div id='mount-add' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_mounts %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="wearItem('Mount', 'mount-add')" class='btn w-75 btn-success'>OK</a>
                    </div>
                </div> 

            </div>
                
        {% endif %}

        {% if mount_armor %}
            <form name='head' method='post' action='changedur-{{ mount_armor.id }}' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                {% csrf_token %}
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 ps-3 pb-0">
                        <span class="text-white-50">Wytrzymałość:</span> {{ mount_armor.durability }}/{{ mount_armor.name|getMaxDurability }}
                    </div>
                    <div class="col h6 text-end p-2 pb-0">
                        Pancerz wierzchowca
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='/dunnorpg/items/{{ mount_armor.name|getDescId }}' class="{{ mount_armor.name|getItemRarity }} h4">
                            {{ mount_armor.name }}
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">
                {% if mount_armor.name|getSkill %}
                    <div class="row me-0 pe-0">
                        <div class="col text-justified {{ mount_armor.name|getItemRarity }} p-0 ps-1 pt-1">
                            {{ mount_armor.name|getSkill }}
                        </div>
                    </div>
                    <hr class="mb-0 mt-1">
                {% endif %}

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Pancerz:</span> <span class="c-gold ms-1" id="mount_armor_value">{{ mount_armor.name|getItemArmor }}</span>
                    </div>                
                    <div class="col-3 border-end border-warning p-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <span class="text-white-50">Waga:</span> <span class="c-gold ms-1">{{ mount_armor.name|getItemWeight }}kg</span>
                    </div>                
                    <div class="col-3 border-end border-warning h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-info p-3 pt-2 pb-2 text-white" onclick='show_or_hideById("mount_armor-swap")'>Zmień</a>
                    </div>                  
                    <div class="col-3 h6 mb-0 d-flex align-items-center justify-content-center">
                        <a class="btn btn-danger p-3 pt-2 pb-2 text-white" href='move_eq-{{ mount_armor.id }}'>Odłóż</a>
                    </div>

                </div>

                <div id='mount_armor-swap' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_mounts_armor %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="swapItem('{{ mount_armor.id }}', 'mount_armor-swap')" class='btn w-75 btn-success'>Zamień</a>
                    </div>
                </div>

            </form>
        {% elif eq_mounts_armor %}
            <div name='head' class='row mt-2 border border-warning rounded bg-gray m-0 p-0'>
                <div class="row c-gold me-0 pe-0">
                    <div class="col h6 text-start p-2 pb-0 ms-1">
                        Pancerz wierzchowca - Brak
                    </div>
                </div>

                <div class="row me-0 pe-0">
                    <div class="col text-center">
                        <a href='' class="c-gold h4">
                            Brak pancerza
                        </a>
                    </div>
                </div>

                <hr class="mb-0 mt-1">

                <div class="row ps-0 ms-1 me-0 pe-0">

                    <div class="col border-end border-warning mb-0 d-flex align-items-center justify-content-center">
                        <a class="text-light h5 btn btn-info m-2 w-75" onclick='show_or_hideById("mount_armor-add")'>Załóż</a>
                    </div>                
                </div>

                <div id='mount_armor-add' class='d-none row text-end m-0 p-0 mt-2 mb-2'>
                    <div class="col-8">
                        <select class='w-100 p-2 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_mounts_armor %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} 
                                    ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col text-start">
                        <a onclick="wearItem('Mount_armor', 'mount_armor-add')" class='btn w-75 btn-success'>OK</a>
                    </div>
                </div> 

            </div>
                
        {% endif %}

        <div class="row mt-3 mb-3 m-0 p-0 text-danger">
            <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
            <div class="col-2 p-0 m-0">
                <h3 class="mt-2 textdanger">Inne</h3>
            </div>
            <div class="col p-0 m-0"><hr class="bg-danger mt-4"></div>
        </div>

        <div class='w-75 ms-5 rounded row bg-gray bg-gradient border border-warning m-0 p-2'>
            <div class="col-5 m-0 p-0 text-end text-white-50 h3">
                Monety:
            </div>
            <div class="col m-0 p-0 h3">
                <form method="post" action="change-coins">
                    {% csrf_token %}
                    <input type='number' min="0" id='coins' class='c-gold text-center border-0 bg-gray bg-gradient m-0 p-0 w-75' style='width: 8vw' value='{{ value.coins }}' name="coins-amount">
                </form>
            </div>
        </div>

        <div class='w-100 bg-gray bg-gradient border border-warning m-0 p-0 mt-2 mb-1'>
            <div class="col-3 m-0 p-0 text-end text-white-50 h3">
                Rasa:
            </div>
            <div class="col m-0 p-0 h3">
                <a class='col c-gold' href='/dunnorpg/info/races/{{ race_id }}' title='{{ race_desc }}'>{{ value.race }}</a>
            </div>
        </div>
    </div>    
    
    <form id="notes-block" class="d-none position-fixed mt-2 border border-warning bg-gray rounded" 
    style="width: 75%; left: 13%; height: 55%;" method="post" action="/dunnorpg/update_field/{{ value.id }}?model=Character">
        {% csrf_token %}
        <div class="row">
            <div class="col"></div>
            <button class="col-2 bg-danger border-0 rounded m-1 text-white" type="button"
            onclick="this.parentNode.parentNode.classList.add('d-none')">X</button>
        </div>
        <div class="row text-center c-gold">
            <input type="hidden" name="id" value="{{ value.id }}">
            <input type="hidden" name="model" value="Character">
            <h5 class="fw-bold col text-center">Notatki:</h5>
        </div>    
        <div class="row">
            <textarea value="test" class="card-body m-2 rounded" name="notes-text"
            style="height: 35vh; background-color: #dbc78a;">{{ value.notes }}</textarea>
        </div>
        <div class="row ms-3 me-3">
            <button type="submit" class="col bg-success border-0 rounded fst-italic">
                Zapisz
            </button>
        </div>
    </form>

    <div name='Effects' class="row d-none m-0 p-0 position-absolute rounded container col card-body c-gold border border-warning bg-dark mt-4">
        <p class="text-center fw-bold">Effects: </p>
        <ul>
        {% for effect in value|getCharacterEffects %}
        <li onclick="show_or_hideById(this.attributes['name'].value)" name='ef{{ effect.id }}' class='fw-bold fst-italic'>
            {{ effect.name }} (+{{ effect.bonus }}) 
            {% if effect.time == 100 %}| Item
            {% elif effect.time == 105 %}| Natural
            {% elif effect.time == 110 %}| Class
            {% else %}| Time left: {{ effect.time }}
            {% endif %}

            {% if user.is_superuser %}
            <a href="/admin/DunnoRPG/effects/{{ effect.id }}/change/" class="ms-2 fa fa-link" target="_blank"></a>
            {% endif %}
        </li>
        <p id='ef{{ effect.id }}' class='d-none'>{{ effect.name|getEffectDesc }}</p>
        {% endfor %}
        </ul>
    </div>
    

    <div name='Skills' style='' class="row m-0 p-0 position-absolute d-none rounded container col card-body c-gold border border-warning bg-dark">
        <p class="text-center fw-bold">Skills: </p>
        <ul class=''>

        <div class='row' onclick=showOrHideBlock(this,"skillsMagical")>
            <p class='col text-center  rounded bg-gray border border-warning p-1'>
                Magical
            </p>
        </div>
        <div id='skillsMagical'>
        {% for skill in skillsMagical %}
            <li class='text-center'>
                <a class='c-gold fst-italic' href='/dunnorpg/skills/{{ skill.original_id }}'>{{ skill.skill }} lvl.{{ skill.level }}</a>
                <button onclick="show_block(this)" name="{{ skill.id }}" type='button' class='fst-italic ms-2 rounded-circle border border-warning btn btn-sm btn-warning btn-outline-dark c-gold'>i</button>
                {% if skill.max_uses != None %}
                    <span>({{ skill.uses_left }}/{{ skill.max_uses }})</span>
                    <a class='text-danger h6' href='use-skill/{{ skill.id }}'>Use</a>

                    {% if user.is_superuser %}
                    <a href="/admin/DunnoRPG/skills/{{ skill.id }}/change/" class="ms-2 fa fa-link" target="_blank"></a>
                    {% endif %}
                {% endif %}
                <div id='{{ skill.id }}' name="desc_block" class="d-none">
                    <p class='fw-bold text-center'>{{ skill.skill }} lvl.{{ skill.level }}</p>
                    {{ skill.desc }}
                    <br>
                    [<span class='fst-italic'>{{ skill.level_desc }}</span>]
                </div>
            </li><br>
        {% endfor %}
        </div>

        <div class='row' onclick=showOrHideBlock(this,"skillsMelee")>
            <p class='col text-center  rounded bg-gray border border-warning p-1'>
                Melee
            </p>
        </div>
        <div id='skillsMelee'>
        {% for skill in skillsMelee %}
            <li class='text-center'>
                <a class='c-gold fst-italic' href='/dunnorpg/skills/{{ skill.original_id }}'>{{ skill.skill }} lvl.{{ skill.level }}</a>
                <button onclick="show_block(this)" name="{{ skill.id }}" type='button' class='fst-italic ms-2 rounded-circle border border-warning btn btn-sm btn-warning btn-outline-dark c-gold'>i</button>
                {% if skill.max_uses != None %}
                    <span>({{ skill.uses_left }}/{{ skill.max_uses }})</span>
                    <a class='text-danger h6' href='use-skill/{{ skill.id }}'>Use</a>

                    {% if user.is_superuser %}
                    <a href="/admin/DunnoRPG/skills/{{ skill.id }}/change/" class="ms-2 fa fa-link" target="_blank"></a>
                    {% endif %}
                {% endif %}
                <div id='{{ skill.id }}' name="desc_block" class="d-none">
                    <p class='fw-bold text-center'>{{ skill.skill }} lvl.{{ skill.level }}</p>
                    {{ skill.desc }}
                    <br>
                    [<span class='fst-italic'>{{ skill.level_desc }}</span>]
                </div>
            </li><br>
        {% endfor %}
        </div>

        <div class='row' onclick=showOrHideBlock(this,"skillsRange")>
            <p class='col text-center  rounded bg-gray border border-warning p-1'>
                Range
            </p>
        </div>
        <div id='skillsRange'>
        {% for skill in skillsRange %}
            <li class='text-center'>
                <a class='c-gold fst-italic' href='/dunnorpg/skills/{{ skill.original_id }}'>{{ skill.skill }} lvl.{{ skill.level }}</a>
                <button onclick="show_block(this)" name="{{ skill.id }}" type='button' class='fst-italic ms-2 rounded-circle border border-warning btn btn-sm btn-warning btn-outline-dark c-gold'>i</button>
                {% if skill.max_uses != None %}
                    <span>({{ skill.uses_left }}/{{ skill.max_uses }})</span>
                    <a class='text-danger h6' href='use-skill/{{ skill.id }}'>Use</a>

                    {% if user.is_superuser %}
                    <a href="/admin/DunnoRPG/skills/{{ skill.id }}/change/" class="ms-2 fa fa-link" target="_blank"></a>
                    {% endif %}
                {% endif %}
                <div id='{{ skill.id }}' name="desc_block" class="d-none">
                    <p class='fw-bold text-center'>{{ skill.skill }} lvl.{{ skill.level }}</p>
                    {{ skill.desc }}
                    <br>
                    [<span class='fst-italic'>{{ skill.level_desc }}</span>]
                </div>
            </li><br>
        {% endfor %}
        </div>

        <div class='row' onclick=showOrHideBlock(this,"skillsAgility")>
            <p class='col text-center  rounded bg-gray border border-warning p-1'>
                Agility
            </p>
        </div>
        <div id='skillsAgility'>
        {% for skill in skillsAgility %}
            <li class='text-center'>
                <a class='c-gold fst-italic' href='/dunnorpg/skills/{{ skill.original_id }}'>{{ skill.skill }} lvl.{{ skill.level }}</a>
                <button onclick="show_block(this)" name="{{ skill.id }}" type='button' class='fst-italic ms-2 rounded-circle border border-warning btn btn-sm btn-warning btn-outline-dark c-gold'>i</button>
                {% if skill.max_uses != None %}
                    <span>({{ skill.uses_left }}/{{ skill.max_uses }})</span>
                    <a class='text-danger h6' href='use-skill/{{ skill.id }}'>Use</a>

                    {% if user.is_superuser %}
                    <a href="/admin/DunnoRPG/skills/{{ skill.id }}/change/" class="ms-2 fa fa-link" target="_blank"></a>
                    {% endif %}
                {% endif %}
                <div id='{{ skill.id }}' name="desc_block" class="d-none">
                    <p class='fw-bold text-center'>{{ skill.skill }} lvl.{{ skill.level }}</p>
                    {{ skill.desc }}
                    <br>
                    [<span class='fst-italic'>{{ skill.level_desc }}</span>]
                </div>
            </li><br>
        {% endfor %}
        </div>

        <div class='row' onclick=showOrHideBlock(this,"skillsOther")>
            <p class='col text-center  rounded bg-gray border border-warning p-1'>
                Other
            </p>
        </div>
        <div id='skillsOther'>
        {% for skill in skillsOther %}
            <li class='text-center'>
                <a class='c-gold fst-italic' href='/dunnorpg/skills/{{ skill.original_id }}'>{{ skill.skill }} lvl.{{ skill.level }}</a>
                <button onclick="show_block(this)" name="{{ skill.id }}" type='button' class='fst-italic ms-2 rounded-circle border border-warning btn btn-sm btn-warning btn-outline-dark c-gold'>i</button>
                {% if skill.max_uses != None %}
                    <span>({{ skill.uses_left }}/{{ skill.max_uses }})</span>
                    <a class='text-danger h6' href='use-skill/{{ skill.id }}'>Use</a>

                    {% if user.is_superuser %}
                    <a href="/admin/DunnoRPG/skills/{{ skill.id }}/change/" class="ms-2 fa fa-link" target="_blank"></a>
                    {% endif %}
                {% endif %}
                <div id='{{ skill.id }}' name="desc_block" class="d-none">
                    <p class='fw-bold text-center'>{{ skill.skill }} lvl.{{ skill.level }}</p>
                    {{ skill.desc }}
                    <br>
                    [<span class='fst-italic'>{{ skill.level_desc }}</span>]
                </div>
            </li><br>
        {% endfor %}
        </div>

        <ul>
    </div>
</div>

<div class='container mt-2'>
    <div class='row'>
        <div onclick='show_result_at_window("Accuraccy")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-crosshairs'> Accuraccy</span>
        </div>
        <div onclick='show_result_at_window("Parry")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-shield-alt'> Parry</span>
        </div>
        <div onclick='show_result_at_window("Attack")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fab fa-pied-piper-alt'> Attack</span>
        </div>
        <div onclick='show_result_at_window("Dodge")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-walking'> Dodge</span>
        </div>
        <div onclick='show_result_at_window("Dice")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-dice-d20'> Dice</span>
        </div>
        <a href='/dunnorpg/items/ch{{ value.id }}' name='eq-link' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-scroll'> Equipment</span>
        </a>
        <div onclick='document.getElementById("notes-block").classList.remove("d-none")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-pencil-alt'> Notes</span>
        </div>
    
</div>

<div class='d-none'>
    <p id='item-skill-int'>{{ value.name|getStatFromItems:"INT" }}</p>
    <p id='item-skill-sil'>{{ value.name|getStatFromItems:"SIŁ" }}</p>
    <p id='item-skill-zre'>{{ value.name|getStatFromItems:"ZRE" }}</p>
    <p id='item-skill-char'>{{ value.name|getStatFromItems:"CHAR" }}</p>
    <p id='item-skill-cel'>{{ value.name|getStatFromItems:"CEL" }}</p>
</div>

<script>
document.title = document.getElementById('char-name').innerHTML + " | DunnoRPG"
document.getElementById('tb-characters').classList.remove('btn-outline-warning')
document.getElementById('tb-characters').classList.add('btn-outline-primary')
function catchErrorForValueChanges(id){
    try{
        trackValueChanges(id)
    }
    catch(TypeError){
        console.log('Cannot track changes for '+id+'. Ignore if you are not GM.')
    }
     
}

trackValueChanges('hp-val')
trackValueChanges('coins')
durs = ['helmet-dur-gm','torso-dur-gm','leftItem-dur-gm','rightItem-dur-gm','sideItem-dur-gm','boots-dur-gm','gloves-dur-gm']
durs.forEach(catchErrorForValueChanges)

function showSkill(instance){
    if(instance.innerHTML == "Check skill"){
        instance.innerHTML = instance.title
    }
    else{
        instance.innerHTML = "Check skill"
    }
}

function makeChangeToRequest(field_id, model, field){
    field_val = document.getElementById(field_id).getAttribute('value')
    chid = document.getElementById('char-name').getAttribute('name')
    url = '/dunnorpg/makerequest/'+chid+';'+model+';'+model+';0;0;'+field+';change_to-'+field_val+';character_detail'
    window.location.replace(url)
}
//Test Function
//makeChangeToRequest('coins','Character','coins')
//makeChangeToRequest('hp-val','Character','hp')

function swapItem(id1, block_id){
    chid = document.getElementById('char-name').getAttribute('name')
    id2 = document.getElementById(block_id).children[0].children[0]
    id2 = id2.options[id2.selectedIndex].id
    url = window.location.href
    url = url+id1+'-'+id2
    window.location.replace(url)
}

function wearItem(place, block_id){
    chid = document.getElementById('char-name').getAttribute('name')
    it1 = document.getElementById(block_id).children[0].children[0]
    it1 = it1.options[it1.selectedIndex].id
    url = window.location.href+it1+';'+place
    window.location.replace(url)
}

function setActive(id){
    let block = document.getElementById(id)

    if(block.classList.contains('active')){
        block.classList.remove('active')
        block.classList.remove('border-primary')
        block.classList.remove('text-primary')
        block.classList.add('border-warning')
        block.classList.add('c-gold') 
    }else{
        block.classList.add('active')
        block.classList.add('border-primary') 
        block.classList.add('text-primary') 
        block.classList.remove('border-warning') 
        block.classList.remove('c-gold') 
    }
}

function calculateGettingHit(){
    let url = window.location.href
    let dmg = document.getElementById('get-dmg-dmg').value
    let ap = document.getElementById('get-dmg-ap').value
    let use_multiplier = Number(document.getElementById('get-dmg-ign-chk').checked)
    let parts_block = document.getElementsByClassName('active get-dmg-place')
    let parts = []
    
    if(dmg==''){dmg=0}
    if(ap==''){ap=0}

    for (let i=0; i<parts_block.length; i++) {
        parts.push(parts_block[i].id.replace('get-dmg-',''))
    }

    let parts_str = parts.join('|')

    window.location.replace(url+`calculate_hit-${dmg}-${ap}-${parts_str}-${use_multiplier}`)
}

function getWeaponMod(){
    let l_item = document.getElementById('l-weight')
    let l_item_full = document.getElementById('l_weapon')
    let l_weight = 0
    let l_weight_shield = 0   
    try{
        if(l_item_full.getAttribute("name").toLowerCase()!="shield"){
            l_weight = parseFloat(document.getElementById('l-weight').innerHTML)
        }else{
            l_weight_shield = parseFloat(document.getElementById('l-weight').innerHTML)
        }
    }catch(error){console.log(error)}

    let r_item = document.getElementById('r-weight')
    let r_item_full = document.getElementById('r_weapon')
    let r_weight = 0
    let r_weight_shield = 0
    try{
        if(r_item_full.getAttribute("name").toLowerCase()!="shield"){
            r_weight = parseFloat(document.getElementById('r-weight').innerHTML)
        }else{
            r_weight_shield = parseFloat(document.getElementById('r-weight').innerHTML)
        }
    }catch(error){console.log(error)}

    sil = parseInt(document.getElementById('stat-SIŁ').innerHTML)
    mod = (r_weight+l_weight)-sil
    mod = parseInt(mod/2)

    modShield = parseInt((r_weight_shield+l_weight_shield)/4)

    document.getElementById('weapon-weight-mod').innerHTML = mod
    document.getElementById('shield-weight-mod').innerHTML = modShield
}
getWeaponMod()

function isHit(hand, dualHanded=false){
    let dice = parseInt(document.getElementById('dice-cel').value)

    accurs = {
        "Pistolet": 8,
        "Muszkiet": 7,
        "Kostur": 6,
        "Tarcza": 6,
        "Kusza": 6,
        "Łuk": 6,
        "Flamethrower": 1
    }

    if(hand=='left'){
        itemName = document.getElementById('l-name').textContent
        itemType = document.getElementById('l-type').textContent
    }else if(hand=='right'){
        itemName = document.getElementById('r-name').textContent
        itemType = document.getElementById('r-type').textContent
    }

    let neededAcc = 6
    console.log(itemName)
    neededAcc = accurs[itemType]
    if(!neededAcc){
        if(dualHanded){
            neededAcc=8
        }else{
            neededAcc=6
        }
    }

    let body_target = document.getElementById('body-target').value
    let multipliers = {
        'head': 2, "torso": 1, "hands": 1.5, "boots": 1.5
    }
    neededAcc = neededAcc*multipliers[body_target]
    
    count_armor = false
    special_classes = ["kusznik", "strzelec wyborowy", "rewolwerowiec", "łucznik"]
    try{
        char_class = document.getElementById("char-class").innerHTML
        if(special_classes.includes(char_class.trim().toLowerCase())){
            count_armor = true
        }
    }catch{
        count_armor = false
    }

    cel_effect_bonus = parseInt(document.getElementById('effects-accuraccy').innerHTML)
    cel = parseInt(document.getElementById('stat-CEL').innerHTML)
    cel_mod = parseInt(document.getElementById('stat-CEL-mod').innerHTML)
    armor_mod = parseInt(document.getElementById('armor-mod').innerHTML) 
    weight_mod = parseInt(document.getElementById('weapon-weight-mod').innerHTML)
    additional_bonus = parseInt(document.getElementById('dice-bonus-cel').value)

    cel_mods = additional_bonus+cel+cel_mod+cel_effect_bonus-weight_mod

    if(count_armor){
        cel_mods -= armor_mod
    }

    dice_result = dice+cel_mods

    if(dice_result >= neededAcc){
        return [true, dice_result, neededAcc]
    }else{
        return [false, dice_result, neededAcc]
    }

}

function finishAttackSequence(){
    show_or_hideById('result-div')
}

async function showAttackResult(hand, dualHanded=false, item_id=null){
    let itName = ""
    let itType = ""
    let stats = ""
    let bonus = ""
    let dur = 100
    let staffDmg = ""
    let itRange = document.getElementById("dice-input-subtitle").textContent.split(' ')[1]
    let multiplier = parseFloat(document.getElementById('dmg-multiplier').value)
    let div = document.getElementById('result-div')
    let txt1 = document.getElementById('result-div-row1')
    let txt2 = document.getElementById('result-div-row2')
    let txt3 = document.getElementById('result-div-row3-col2')
    let body_target = document.getElementById('body-target').value
    let isDestr = document.getElementById('is-destructible').value
    let url = window.location.href
    let ammo_unavailable = document.getElementById('ammo-row').classList.contains('d-none')
    let ammo = document.getElementById('chosen-ammo').value
    let ammo_amount = document.getElementById('ammo-count').value

    if(body_target=='head' && multiplier<1.5){
        multiplier=1.5
    }

    console.log(ammo_unavailable)
    if(isDestr=='destructible'){
        let take_ammo = await fetch(url+`take_dur-${item_id}`, {
            method: "GET"
        })
    }

    if(!ammo_unavailable && ammo!='not-needed'){
        let take_dur = await fetch(url+`take_ammo-${ammo}-${ammo_amount}`, {
            method: "GET"
        })
    }

    let hit = isHit(hand, dualHanded)

    if(hand=='left'){
        dur = parseFloat(parseInt(document.getElementById('l-dur-perc').textContent.replace('%)','').slice(1))/100)
        itName = document.getElementById('l-name').textContent
        itType = document.getElementById('l-type').textContent
        stats = document.getElementById('l_stats').textContent
        bonus = document.getElementById('l_bonus').textContent
        staffDmg = document.getElementById('l-staff-dmg').textContent.split(";")[0].slice(1)
    }else{
        dur = parseFloat(parseInt(document.getElementById('r-dur-perc').textContent.replace('%)','').slice(1))/100)
        itName = document.getElementById('r-name').textContent
        itType = document.getElementById('r-type').textContent
        stats = document.getElementById('r_stats').textContent
        bonus = document.getElementById('r_bonus').textContent
        staffDmg = document.getElementById('r-staff-dmg').textContent.split(";")[0].slice(1)
    }

    console.log(dur)
    if(bonus==''){
        bonus = 0
    }else{
        bonus = parseInt(bonus.slice(1,-1))
    }

    let weapon_dmg = parseInt(stats.split(', ')[0].replace('1K',''))
    let weapon_ap = Math.round(parseInt(stats.split(', ')[1].replace('AP',''))*multiplier*dur)
    if(itType=='Kostur'){
        weapon_dmg = parseInt(staffDmg.split(', ')[0].replace('1K',''))
        weapon_ap = Math.round(parseInt(staffDmg.split(', ')[1].replace('AP',''))*multiplier)
    }

    if(hit[0]){
        txt1.classList.remove("text-danger")
        txt1.classList.add("unique")
        txt1.textContent = `Trafiony (Wynik: ${hit[1]}/${hit[2]})`
    }else{
        txt1.classList.add("text-danger")
        txt1.classList.remove("unique")
        txt1.textContent = `Chybiony (Wynik: ${hit[1]}/${hit[2]})`
    }

    let dice = parseInt(document.getElementById('dice-dmg').value)
    let dice_bonus = parseInt(document.getElementById('dice-bonus').value)
    let attack_effect_bonus = parseInt(document.getElementById('effects-attack').textContent)
    let sil = parseInt(document.getElementById('stat-SIŁ').textContent)
    let sil_mod = parseInt(document.getElementById('stat-SIŁ-mod').textContent) 
    let amulet_bonus = parseInt(document.getElementById('amulet-attack-mod').textContent)

    if(itRange>3){
        sil=0
        sil_mod=0
    }

    let result = Math.round((attack_effect_bonus+sil+sil_mod+amulet_bonus+dice+dice_bonus+bonus+weapon_dmg)*multiplier*dur)
    txt3.textContent = `${result} + ${weapon_ap} AP`

    txt2.textContent = `${itName} - ${itType}`
    div.classList.remove("d-none")
}

function gatherAttackInfo(hand, item_id){
    let div = document.getElementById('dice-input')
    let title = document.getElementById('dice-input-title')
    let subtitle = document.getElementById('dice-input-subtitle')
    let btn = document.getElementById('attack-confirm-btn')
    let dualHanded = ""
    let itemName = ""
    let itemType = ""
    let itemRange = ""

    if(hand=='left'){
        itemName = document.getElementById('l-name').textContent
        itemType = document.getElementById('l-type').textContent
        dualHanded = document.getElementById('l-dualhanded').textContent
        itemRange = document.getElementById('l-range').textContent
    }else if(hand=='right'){
        itemName = document.getElementById('r-name').textContent
        itemType = document.getElementById('r-type').textContent
        itemRange = document.getElementById('r-range').textContent
    }

    if(itemRange<4){
        document.getElementById('ammo-row').classList.add('d-none')
    }else{
        document.getElementById('ammo-row').classList.remove('d-none')
    }

    subtitle.textContent = `Zasięg: ${itemRange}`
    title.textContent = `${itemName}`

    btn.onclick = function(){
        div.classList.add("d-none")
        showAttackResult(hand, dualHanded, item_id)
    }

    div.classList.remove("d-none")
}

function getArmorMod(){
    armor_weight = parseInt(document.getElementById('armor-weight').innerHTML)
    mod = armor_weight/4
    mod = parseInt(mod)
    try{
        if(document.getElementById('char-class').innerHTML.trim() == 'Berserker'){
            mod = mod*2
        }
    }
    catch(TypeError){
        console.log('No class chosen...')
    }
    document.getElementById('armor-mod').innerHTML = mod
}
getArmorMod()

function calculateMountArmor(){
    try{
        default_armor = document.getElementById("mount_armor_default").innerHTML
        try{
            let mount_armor = document.getElementById("mount_armor_value").innerHTML
            document.getElementById("mount_armor_default").innerHTML = parseInt(default_armor)+parseInt(mount_armor)
        }catch{}
    }
    catch{}
}
calculateMountArmor()

function getRandomInt(min=1,max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min) + min);
    }

function show_block(instance){
    let blocks = document.getElementsByName('desc_block')
    for (let i = 0; i < blocks.length; i++){
            if(blocks[i].id==instance.name){
                if(blocks[i].classList.contains('d-none')){
                    blocks[i].classList.remove('d-none')
                }
                else{
                    blocks[i].classList.add('d-none')
                }
            }
            else{
                blocks[i].classList.add('d-none')
            }
        }
    };

function show_or_hideByName(instance, changeColor=false, directId=false){

    let element = document.getElementsByName(instance.id)[0]
    if(directId){
        element = document.getElementById(instance)
    }
    
    if (element.classList.contains('d-none')){
        element.classList.remove('d-none')

        instance.classList.remove('btn-outline-warning')
        instance.classList.remove('border-warning')

        instance.classList.add('btn-outline-primary')
        instance.classList.add('border-primary')
    }
    else{
        element.classList.add('d-none')

        instance.classList.remove('btn-outline-primary')
        instance.classList.remove('border-primary')

        instance.classList.add('btn-outline-warning')
        instance.classList.add('border-warning')
    }
};

function show_or_hideById(id){
    let element = document.getElementById(id)
    if (element.classList.contains('d-none')){
        element.classList.remove('d-none')
    }
    else{
        element.classList.add('d-none')
    }
};

function change_result(text, element, mods, result, additional=false){

    if(additional){
        element = document.getElementById('window-action-text-top')
    }
    else{
        element = document.getElementById('window-action-text-center')
    }

    if (element.innerHTML == text){
        element.innerHTML = result
    }
    else{
        element.innerHTML = text
    }
}

function show_result_at_window(action){
    document.getElementById('pop-window').classList.remove('d-none')


    window_action = document.getElementById('window-action-text-center')
    window_action_additional = document.getElementById('window-action-text-top')

    window_url = document.getElementById('window-footer-text')

    const left_range  = document.getElementById('l-range')?.textContent  ?? '?'
    const right_range = document.getElementById('r-range')?.textContent ?? '?'

    if(action=='Dice'){window_url.innerHTML = 'Google Dice'}
    else{window_url.innerHTML = ''}


    if(action == 'Dice')
    {
        diceRoll = getRandomInt(1,21)
        window_action.innerHTML = "<b>Dice:</b> " + diceRoll
        window_action.onclick = ''
        window_action_additional.innerHTML = ''
        window_action_additional.onclick = ''
    }

    else if (action == 'Accuraccy')
    {
        count_armor = false
        special_classes = ["kusznik", "strzelec wyborowy", "rewolwerowiec", "łucznik"]
        try{
            char_class = document.getElementById("char-class").innerHTML
            if(special_classes.includes(char_class.trim().toLowerCase())){
                count_armor = true
            }
        }catch{
            count_armor = false
        }
        window_action_additional.innerHTML = ''
        window_action_additional.onclick = ''
        cel_effect_bonus = parseInt(document.getElementById('effects-accuraccy').innerHTML)
        cel = parseInt(document.getElementById('stat-CEL').innerHTML)
        cel_mod = parseInt(document.getElementById('stat-CEL-mod').innerHTML)
        armor_mod = parseInt(document.getElementById('armor-mod').innerHTML) 
        weight_mod = document.getElementById('weapon-weight-mod').innerHTML
        cel_mods = cel+cel_mod+cel_effect_bonus-weight_mod
        if(count_armor){
            cel_mods -= armor_mod
        }

        dice_result = getDiceWMods(window_action,cel_mods,getResult=true,text=action)

        details = 'CEL'+'('+cel+')'+ ' + '+'MODS'+'('+(cel_mod+cel_effect_bonus)+')'+' - WEAPON WEIGHT('+weight_mod+')'
        if(count_armor){
            details += ' & ARMOR'+'('+(-armor_mod)+')'
        }
        window_action.onclick = function() {change_result(details,window_action,cel_mods, dice_result)}
        console.log(count_armor)
    }
    
    else if (action == 'Dodge')
    {
        dodge_effect_bonus = parseInt(document.getElementById('effects-dodge').innerHTML)
        zre = parseInt(document.getElementById('stat-ZRE').innerHTML)
        zre_mod = parseInt(document.getElementById('stat-ZRE-mod').innerHTML) 
        armor_mod = parseInt(document.getElementById('armor-mod').innerHTML) 
        weight_mod = document.getElementById('shield-weight-mod').innerHTML
        dodge_mods = zre+zre_mod+dodge_effect_bonus-armor_mod-weight_mod

        window_action_additional.innerHTML = ''
        window_action_additional.onclick = ''

        dice_result = getDiceWMods(window_action,dodge_mods,getResult=true,text=action)

        details = 'ZRE'+'('+zre+')'+ ' + '+'MODS'+'('+(zre_mod+dodge_effect_bonus)+')'+ ' + '+'ARMOR'+'('+(-armor_mod)+')'+' - SHIELD WEIGHT('+weight_mod+')'
        window_action.onclick = function() {change_result(details,window_action,dodge_mods, dice_result)}
    }

    else if (action == 'Attack')
    {
        attack_effect_bonus = parseInt(document.getElementById('effects-attack').innerHTML)
        sil = parseInt(document.getElementById('stat-SIŁ').innerHTML)
        sil_mod = parseInt(document.getElementById('stat-SIŁ-mod').innerHTML) 
        amulet_bonus = parseInt(document.getElementById('amulet-attack-mod').innerHTML) 


        if(document.getElementById('l_bonus').innerHTML != 'Empty')
        {
            leftWeapon = document.getElementById('l_weapon')
            l_type = leftWeapon.getAttribute('name')
            if(['Pistol','Musket','Crossbow','Bow'].includes(l_type)){
                sil=0
                sil_mod=0
            }
            l_bonus = parseInt(document.getElementById('l_bonus').innerHTML)+amulet_bonus
            l_range = `[Zasięg ${left_range}] `

            if(leftWeapon.getAttribute("name") == 'shield')
            { //shield-left-hand-attack
                shield_attack_mods = sil+sil_mod-10+attack_effect_bonus
                l_shield_dice_result = l_range+getDiceWMods(window_action_additional,shield_attack_mods,getResult=true,text='Left hand',d0exception=false ,prefix=l_range)
                l_shield_details = 'SIŁ'+'('+sil+')'+ ' + ' + 'MODS'+'('+sil_mod+')'+' + '+'BONUS'+'('+l_bonus+')'+' + '+'BASIC(-10)'
                window_action_additional.onclick = function() {change_result(l_shield_details,window_action_additional,shield_attack_mods, l_shield_dice_result,additional=true)}
            }
            else
            { //normal-left-hand-attack
                leftWeaponDmg = parseInt(document.getElementById('l_dmg').innerHTML)
                leftWeaponAp = parseInt(document.getElementById('l_ap').innerHTML)
                l_mods = sil+sil_mod+leftWeaponDmg+l_bonus+attack_effect_bonus
                l_normal_dice_result = l_range+getDiceWMods(window_action_additional,l_mods,getResult=true,text='Left hand',d0exception=false ,prefix=l_range)
                l_normal_details = 'SIŁ'+'('+sil+')'+ ' + '+'MODS'+'('+(sil_mod+attack_effect_bonus)+')'+' + '+'WEAPON'+'('+leftWeaponDmg+')'+' + '+'BONUS'+'('+l_bonus+')'+' ; '+'AP'+'('+leftWeaponAp+')'
                window_action_additional.onclick = function() {change_result(l_normal_details,window_action_additional,l_mods, l_normal_dice_result,additional=true)}
            }
        }
        else{window_action_additional.innerHTML = 'Left hand: Empty'}



        if(document.getElementById('r_bonus').innerHTML != 'Empty' && document.getElementById('r_bonus').innerHTML != '')
        {
            rightWeapon = document.getElementById('r_weapon')
            r_bonus = parseInt(document.getElementById('r_bonus').innerHTML)+amulet_bonus
            r_type = rightWeapon.getAttribute('name')
            r_range = `[Zasięg ${right_range}] `
            if(['Pistol','Musket','Crossbow','Bow'].includes(r_type)){
                sil=0
                sil_mod=0
            }

            if(rightWeapon.getAttribute("name") == 'shield')
            { //shield-right-hand-attack
                shield_attack_mods = sil+sil_mod-10+attack_effect_bonus
                r_shield_dice_result = r_range+getDiceWMods(window_action,shield_attack_mods,getResult=true,text='Right hand',d0exception=false ,prefix=r_range)
                r_shield_details = 'SIŁ'+'('+sil+')'+ ' + ' + 'MODS'+'('+sil_mod+')'+' + '+'BONUS'+'('+r_bonus+')'+' + '+'BASIC(-10)'
                window_action.onclick = function() {change_result(r_shield_details,window_action,shield_attack_mods, r_shield_dice_result)}
            }
            else
            { //normal-right-hand-attack
                rightWeaponDmg = parseInt(document.getElementById('r_dmg').innerHTML)
                rightWeaponAp = parseInt(document.getElementById('r_ap').innerHTML)
                r_mods = sil+sil_mod+rightWeaponDmg+r_bonus+attack_effect_bonus
                r_normal_dice_result = r_range+getDiceWMods(window_action,r_mods,getResult=true,text='Right hand',d0exception=false ,prefix=r_range)
                r_normal_details = 'SIŁ'+'('+sil+')'+ ' + '+'MODS'+'('+(sil_mod+attack_effect_bonus)+')'+' + '+'WEAPON'+'('+rightWeaponDmg+')'+' + '+'BONUS'+'('+r_bonus+')'+' ; '+'AP'+'('+rightWeaponAp+')'
                window_action.onclick = function() {change_result(r_normal_details,window_action,r_mods, r_normal_dice_result)}
            }  
        }
        else{window_action.innerHTML = 'Right hand: Empty'}
    }

    else if (action == 'Parry')
    {
        parry_effect_bonus = parseInt(document.getElementById('effects-parry').innerHTML)
        sil = parseInt(document.getElementById('stat-SIŁ').innerHTML)
        sil_mod = parseInt(document.getElementById('stat-SIŁ-mod').innerHTML) 


        if(document.getElementById('l_bonus').innerHTML != 'Empty')
        {
            leftWeapon = document.getElementById('l_weapon')
            l_bonus = parseInt(document.getElementById('l_bonus').innerHTML)

            if(leftWeapon.getAttribute("name") == 'shield')
            { //shield-left-hand-attack
                l_block = parseInt(document.getElementById('l_block').innerHTML)
                l_shield_dice_result = getDiceWMods(window_action_additional,(l_block+l_bonus),getResult=true,text='Left hand', d0exception=true)
                l_shield_details = 'BLOCK'+'('+l_block+')'+ ' + ' + 'BONUS'+'('+l_bonus+')'
                window_action_additional.onclick = function() {change_result(l_shield_details,window_action_additional,(l_block+l_bonus), l_shield_dice_result,additional=true)}
            }
            else
            { //normal-left-hand-parry
                leftWeaponDmg = parseInt(document.getElementById('l_dmg').innerHTML)
                leftWeaponAp = parseInt(document.getElementById('l_ap').innerHTML)
                l_mods = sil+sil_mod+leftWeaponDmg+l_bonus+parry_effect_bonus
                l_normal_dice_result = getDiceWMods(window_action_additional,l_mods,getResult=true,text='Left hand')
                l_normal_details = 'SIŁ'+'('+sil+')'+ ' + '+'MODS'+'('+(sil_mod+parry_effect_bonus)+')'+' + '+'WEAPON'+'('+leftWeaponDmg+')'+' + '+'BONUS'+'('+l_bonus+')'
                window_action_additional.onclick = function() {change_result(l_normal_details,window_action_additional,l_mods, l_normal_dice_result,additional=true)}
            }
        }
        else{window_action_additional.innerHTML = 'Left hand: Empty'}



        if(document.getElementById('r_bonus').innerHTML != 'Empty' && document.getElementById('r_bonus').innerHTML != '')
        {
            rightWeapon = document.getElementById('r_weapon')
            r_bonus = parseInt(document.getElementById('r_bonus').innerHTML)

            if(rightWeapon.getAttribute("name") == 'shield')
            { //shield-right-hand-attack
                r_block = parseInt(document.getElementById('r_block').innerHTML)
                r_shield_dice_result = getDiceWMods(window_action,(r_block+r_bonus),getResult=true,text='Right hand', d0exception=true)
                r_shield_details = 'BLOCK'+'('+r_block+')'+ ' + ' + 'BONUS'+'('+r_bonus+')'
                window_action.onclick = function() {change_result(r_shield_details,window_action,(r_block+r_bonus), r_shield_dice_result)}
            }
            else
            { //normal-right-hand-parry
                rightWeaponDmg = parseInt(document.getElementById('r_dmg').innerHTML)
                rightWeaponAp = parseInt(document.getElementById('r_ap').innerHTML)
                r_mods = sil+sil_mod+rightWeaponDmg+r_bonus+parry_effect_bonus
                r_normal_dice_result = getDiceWMods(window_action,r_mods,getResult=true,text='Right hand')
                r_normal_details = 'SIŁ'+'('+sil+')'+ ' + '+'MODS'+'('+(sil_mod+parry_effect_bonus)+')'+' + '+'WEAPON'+'('+rightWeaponDmg+')'+' + '+'BONUS'+'('+r_bonus+')'
                window_action.onclick = function() {change_result(r_normal_details,window_action,r_mods, r_normal_dice_result)}
            }
        }
        else{window_action.innerHTML = 'Right hand: Empty'}
    }
}

function getDiceWMods(instance,modsPoints,getResult=false,text='Result', d0exception=false, prefix=''){
    if (d0exception){
        dice = 0
    }
    else{
        dice = getRandomInt(1,21)
    }
    result = dice+modsPoints
    if(result < 1){
        result = 1
    }
    instance.innerHTML = `${prefix}${text}: ` + result + ' (Dice ' + dice + ')'
    if (getResult){
        return text + ': ' + result + ' (Dice ' + dice + ')'
    }
}
</script>

{% endfor %}
{% endblock content %}